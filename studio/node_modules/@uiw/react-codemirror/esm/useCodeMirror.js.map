{
  "version": 3,
  "names": [
    "useEffect",
    "useState",
    "EditorState",
    "StateEffect",
    "indentWithTab",
    "EditorView",
    "keymap",
    "placeholder",
    "basicSetup",
    "oneDark",
    "getStatistics",
    "useCodeMirror",
    "props",
    "value",
    "selection",
    "onChange",
    "onStatistics",
    "onCreateEditor",
    "onUpdate",
    "extensions",
    "autoFocus",
    "theme",
    "height",
    "minHeight",
    "maxHeight",
    "placeholderStr",
    "width",
    "minWidth",
    "maxWidth",
    "editable",
    "readOnly",
    "defaultIndentWithTab",
    "defaultBasicSetup",
    "root",
    "initialState",
    "container",
    "setContainer",
    "view",
    "setView",
    "state",
    "setState",
    "defaultLightThemeOption",
    "backgroundColor",
    "dark",
    "defaultThemeOption",
    "updateListener",
    "of",
    "vu",
    "docChanged",
    "doc",
    "toString",
    "getExtensions",
    "unshift",
    "push",
    "concat",
    "config",
    "stateCurrent",
    "fromJSON",
    "json",
    "fields",
    "create",
    "viewCurrent",
    "parent",
    "undefined",
    "destroy",
    "focus",
    "dispatch",
    "effects",
    "reconfigure",
    "currentValue",
    "changes",
    "from",
    "to",
    "length",
    "insert"
  ],
  "sources": [
    "../src/useCodeMirror.ts"
  ],
  "sourcesContent": [
    "import { useEffect, useState } from 'react';\nimport { EditorState, StateEffect } from '@codemirror/state';\nimport { indentWithTab } from '@codemirror/commands';\nimport { EditorView, keymap, ViewUpdate, placeholder } from '@codemirror/view';\nimport { basicSetup } from '@uiw/codemirror-extensions-basic-setup';\nimport { oneDark } from '@codemirror/theme-one-dark';\nimport { getStatistics } from './utils';\nimport { ReactCodeMirrorProps } from '.';\n\nexport interface UseCodeMirror extends ReactCodeMirrorProps {\n  container?: HTMLDivElement | null;\n}\n\nexport function useCodeMirror(props: UseCodeMirror) {\n  const {\n    value,\n    selection,\n    onChange,\n    onStatistics,\n    onCreateEditor,\n    onUpdate,\n    extensions = [],\n    autoFocus,\n    theme = 'light',\n    height = '',\n    minHeight = '',\n    maxHeight = '',\n    placeholder: placeholderStr = '',\n    width = '',\n    minWidth = '',\n    maxWidth = '',\n    editable = true,\n    readOnly = false,\n    indentWithTab: defaultIndentWithTab = true,\n    basicSetup: defaultBasicSetup = true,\n    root,\n    initialState,\n  } = props;\n  const [container, setContainer] = useState<HTMLDivElement>();\n  const [view, setView] = useState<EditorView>();\n  const [state, setState] = useState<EditorState>();\n  const defaultLightThemeOption = EditorView.theme(\n    {\n      '&': {\n        backgroundColor: '#fff',\n      },\n    },\n    {\n      dark: false,\n    },\n  );\n  const defaultThemeOption = EditorView.theme({\n    '&': {\n      height,\n      minHeight,\n      maxHeight,\n      width,\n      minWidth,\n      maxWidth,\n    },\n  });\n  const updateListener = EditorView.updateListener.of((vu: ViewUpdate) => {\n    if (vu.docChanged && typeof onChange === 'function') {\n      const doc = vu.state.doc;\n      const value = doc.toString();\n      onChange(value, vu);\n    }\n    onStatistics && onStatistics(getStatistics(vu));\n  });\n\n  let getExtensions = [updateListener, defaultThemeOption];\n  if (defaultIndentWithTab) {\n    getExtensions.unshift(keymap.of([indentWithTab]));\n  }\n  if (defaultBasicSetup) {\n    if (typeof defaultBasicSetup === 'boolean') {\n      getExtensions.unshift(basicSetup());\n    } else {\n      getExtensions.unshift(basicSetup(defaultBasicSetup));\n    }\n  }\n\n  if (placeholderStr) {\n    getExtensions.unshift(placeholder(placeholderStr));\n  }\n\n  switch (theme) {\n    case 'light':\n      getExtensions.push(defaultLightThemeOption);\n      break;\n    case 'dark':\n      getExtensions.push(oneDark);\n      break;\n    case 'none':\n      break;\n    default:\n      getExtensions.push(theme);\n      break;\n  }\n\n  if (editable === false) {\n    getExtensions.push(EditorView.editable.of(false));\n  }\n  if (readOnly) {\n    getExtensions.push(EditorState.readOnly.of(true));\n  }\n\n  if (onUpdate && typeof onUpdate === 'function') {\n    getExtensions.push(EditorView.updateListener.of(onUpdate));\n  }\n  getExtensions = getExtensions.concat(extensions);\n\n  useEffect(() => {\n    if (container && !state) {\n      const config = {\n        doc: value,\n        selection,\n        extensions: getExtensions,\n      };\n      const stateCurrent = initialState\n        ? EditorState.fromJSON(initialState.json, config, initialState.fields)\n        : EditorState.create(config);\n      setState(stateCurrent);\n      if (!view) {\n        const viewCurrent = new EditorView({\n          state: stateCurrent,\n          parent: container,\n          root,\n        });\n        setView(viewCurrent);\n        onCreateEditor && onCreateEditor(viewCurrent, stateCurrent);\n      }\n    }\n    return () => {\n      if (view) {\n        setState(undefined);\n        setView(undefined);\n      }\n    };\n  }, [container, state]);\n\n  useEffect(() => setContainer(props.container!), [props.container]);\n\n  useEffect(\n    () => () => {\n      if (view) {\n        view.destroy();\n        setView(undefined);\n      }\n    },\n    [view],\n  );\n\n  useEffect(() => {\n    if (autoFocus && view) {\n      view.focus();\n    }\n  }, [autoFocus, view]);\n\n  useEffect(() => {\n    if (view) {\n      view.dispatch({ effects: StateEffect.reconfigure.of(getExtensions) });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    theme,\n    extensions,\n    height,\n    minHeight,\n    maxHeight,\n    width,\n    minWidth,\n    maxWidth,\n    placeholderStr,\n    editable,\n    readOnly,\n    defaultIndentWithTab,\n    defaultBasicSetup,\n    onChange,\n    onUpdate,\n  ]);\n\n  useEffect(() => {\n    if (value === undefined) {\n      return;\n    }\n    const currentValue = view ? view.state.doc.toString() : '';\n    if (view && value !== currentValue) {\n      view.dispatch({\n        changes: { from: 0, to: currentValue.length, insert: value || '' },\n      });\n    }\n  }, [value, view]);\n\n  return { state, setState, view, setView, container, setContainer };\n}\n"
  ],
  "mappings": "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"
}
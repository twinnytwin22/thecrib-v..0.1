{"version":3,"file":"browser-progress.js","names":["onRequest","evt","adapter","xhr","request","context","upload","onprogress","handleProgress","stage","event","percent","lengthComputable","loaded","total","channels","progress","publish"],"sources":["../../../src/middleware/progress/browser-progress.js"],"sourcesContent":["export default () => ({\n  onRequest: evt => {\n    if (evt.adapter !== 'xhr') {\n      return\n    }\n\n    const xhr = evt.request\n    const context = evt.context\n\n    if ('upload' in xhr && 'onprogress' in xhr.upload) {\n      xhr.upload.onprogress = handleProgress('upload')\n    }\n\n    if ('onprogress' in xhr) {\n      xhr.onprogress = handleProgress('download')\n    }\n\n    function handleProgress(stage) {\n      return event => {\n        const percent = event.lengthComputable ? (event.loaded / event.total) * 100 : -1\n        context.channels.progress.publish({\n          stage,\n          percent,\n          total: event.total,\n          loaded: event.loaded,\n          lengthComputable: event.lengthComputable\n        })\n      }\n    }\n  }\n})\n"],"mappings":";;;;;;;eAAe,OAAO;EACpBA,SAAS,EAAEC,GAAG,IAAI;IAChB,IAAIA,GAAG,CAACC,OAAJ,KAAgB,KAApB,EAA2B;MACzB;IACD;;IAED,MAAMC,GAAG,GAAGF,GAAG,CAACG,OAAhB;IACA,MAAMC,OAAO,GAAGJ,GAAG,CAACI,OAApB;;IAEA,IAAI,YAAYF,GAAZ,IAAmB,gBAAgBA,GAAG,CAACG,MAA3C,EAAmD;MACjDH,GAAG,CAACG,MAAJ,CAAWC,UAAX,GAAwBC,cAAc,CAAC,QAAD,CAAtC;IACD;;IAED,IAAI,gBAAgBL,GAApB,EAAyB;MACvBA,GAAG,CAACI,UAAJ,GAAiBC,cAAc,CAAC,UAAD,CAA/B;IACD;;IAED,SAASA,cAAT,CAAwBC,KAAxB,EAA+B;MAC7B,OAAOC,KAAK,IAAI;QACd,MAAMC,OAAO,GAAGD,KAAK,CAACE,gBAAN,GAA0BF,KAAK,CAACG,MAAN,GAAeH,KAAK,CAACI,KAAtB,GAA+B,GAAxD,GAA8D,CAAC,CAA/E;QACAT,OAAO,CAACU,QAAR,CAAiBC,QAAjB,CAA0BC,OAA1B,CAAkC;UAChCR,KADgC;UAEhCE,OAFgC;UAGhCG,KAAK,EAAEJ,KAAK,CAACI,KAHmB;UAIhCD,MAAM,EAAEH,KAAK,CAACG,MAJkB;UAKhCD,gBAAgB,EAAEF,KAAK,CAACE;QALQ,CAAlC;MAOD,CATD;IAUD;EACF;AA7BmB,CAAP,C"}
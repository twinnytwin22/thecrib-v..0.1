{"version":3,"file":"node-request.js","names":["qs","require","url","http","https","concat","follow","timedOut","isStream","toStream","progressStream","decompressResponse","getProxyOptions","rewriteUriForProxy","tunneling","adapter","reduceResponse","res","reqUrl","method","body","headers","statusCode","statusMessage","module","exports","context","cb","options","uri","parse","bodyType","Buffer","isBuffer","Error","lengthHeader","bodySize","byteLength","aborted","callback","err","channels","abort","subscribe","reqOpts","lowerCaseHeaders","maxRedirects","proxy","tunnel","shouldEnable","injectedResponse","applyMiddleware","undefined","cbTimer","setImmediate","clearImmediate","applyAgent","auth","username","password","split","map","item","unescape","from","authBase64","toString","transport","getRequestTransport","debug","agent","host","port","tryCompressed","compress","finalOptions","request","response","resStream","responseUrl","stream","data","rawBody","reduced","timeout","once","getProgressStream","bodyStream","progress","pipe","end","bodyIsStream","length","time","isHttpsRequest","protocol","transports","isHttpsProxy","test","Object","keys","reduce","acc","header","toLowerCase"],"sources":["../../src/request/node-request.js"],"sourcesContent":["/* eslint-disable no-process-env */\nconst qs = require('querystring')\nconst url = require('url')\nconst http = require('http')\nconst https = require('https')\nconst concat = require('simple-concat')\nconst follow = require('follow-redirects')\nconst timedOut = require('@sanity/timed-out')\nconst isStream = require('is-stream')\nconst toStream = require('into-stream')\nconst progressStream = require('progress-stream')\nconst decompressResponse = require('decompress-response')\nconst {getProxyOptions, rewriteUriForProxy} = require('./node/proxy')\nconst tunneling = require('./node/tunnel')\n\nconst adapter = 'node'\n\n// Reduce a fully fledged node-style response object to\n// something that works in both browser and node environment\nconst reduceResponse = (res, reqUrl, method, body) => ({\n  body,\n  url: reqUrl,\n  method: method,\n  headers: res.headers,\n  statusCode: res.statusCode,\n  statusMessage: res.statusMessage\n})\n\nmodule.exports = (context, cb) => {\n  const options = context.options\n  const uri = Object.assign({}, url.parse(options.url))\n  const bodyType = isStream(options.body) ? 'stream' : typeof options.body\n\n  if (\n    bodyType !== 'undefined' &&\n    bodyType !== 'stream' &&\n    bodyType !== 'string' &&\n    !Buffer.isBuffer(options.body)\n  ) {\n    throw new Error(`Request body must be a string, buffer or stream, got ${bodyType}`)\n  }\n\n  const lengthHeader = {}\n  if (options.bodySize) {\n    lengthHeader['content-length'] = options.bodySize\n  } else if (options.body && bodyType !== 'stream') {\n    lengthHeader['content-length'] = Buffer.byteLength(options.body)\n  }\n\n  // Make sure callback is not called in the event of a cancellation\n  let aborted = false\n  const callback = (err, res) => !aborted && cb(err, res)\n  context.channels.abort.subscribe(() => {\n    aborted = true\n  })\n\n  // Create a reduced subset of options meant for the http.request() method\n  let reqOpts = Object.assign({}, uri, {\n    method: options.method,\n    headers: Object.assign({}, lowerCaseHeaders(options.headers), lengthHeader),\n    maxRedirects: options.maxRedirects\n  })\n\n  // Figure out proxying/tunnel options\n  const proxy = getProxyOptions(options)\n  const tunnel = proxy && tunneling.shouldEnable(options)\n\n  // Allow middleware to inject a response, for instance in the case of caching or mocking\n  const injectedResponse = context.applyMiddleware('interceptRequest', undefined, {\n    adapter,\n    context\n  })\n\n  // If middleware injected a response, treat it as we normally would and return it\n  // Do note that the injected response has to be reduced to a cross-environment friendly response\n  if (injectedResponse) {\n    const cbTimer = setImmediate(callback, null, injectedResponse)\n    const abort = () => clearImmediate(cbTimer)\n    return {abort}\n  }\n\n  // We're using the follow-redirects module to transparently follow redirects\n  if (options.maxRedirects !== 0) {\n    reqOpts.maxRedirects = options.maxRedirects || 5\n  }\n\n  // Apply currect options for proxy tunneling, if enabled\n  if (proxy && tunnel) {\n    reqOpts = tunneling.applyAgent(reqOpts, proxy)\n  } else if (proxy && !tunnel) {\n    reqOpts = rewriteUriForProxy(reqOpts, uri, proxy)\n  }\n\n  // Handle proxy authorization if present\n  if (!tunnel && proxy && proxy.auth && !reqOpts.headers['proxy-authorization']) {\n    const [username, password] = proxy.auth.username\n      ? [proxy.auth.username, proxy.auth.password]\n      : proxy.auth.split(':').map(item => qs.unescape(item))\n\n    const auth = Buffer.from(`${username}:${password}`, 'utf8')\n    const authBase64 = auth.toString('base64')\n    reqOpts.headers['proxy-authorization'] = `Basic ${authBase64}`\n  }\n\n  // Figure out transport (http/https, forwarding/non-forwarding agent)\n  const transport = getRequestTransport(reqOpts, proxy, tunnel)\n  if (typeof options.debug === 'function' && proxy) {\n    options.debug(\n      'Proxying using %s',\n      reqOpts.agent ? 'tunnel agent' : `${reqOpts.host}:${reqOpts.port}`\n    )\n  }\n\n  // See if we should try to request a compressed response (and decompress on return)\n  const tryCompressed = reqOpts.method !== 'HEAD'\n  if (tryCompressed && !reqOpts.headers['accept-encoding'] && options.compress !== false) {\n    reqOpts.headers['accept-encoding'] = 'br, gzip, deflate'\n  }\n\n  const finalOptions = context.applyMiddleware('finalizeOptions', reqOpts)\n  const request = transport.request(finalOptions, response => {\n    const res = tryCompressed ? decompressResponse(response) : response\n    const resStream = context.applyMiddleware('onHeaders', res, {\n      headers: response.headers,\n      adapter,\n      context\n    })\n\n    // On redirects, `responseUrl` is set\n    const reqUrl = response.responseUrl || options.url\n\n    if (options.stream) {\n      callback(null, reduceResponse(res, reqUrl, reqOpts.method, resStream))\n      return\n    }\n\n    // Concatenate the response body, then parse the response with middlewares\n    concat(resStream, (err, data) => {\n      if (err) {\n        return callback(err)\n      }\n\n      const body = options.rawBody ? data : data.toString()\n      const reduced = reduceResponse(res, reqUrl, reqOpts.method, body)\n      return callback(null, reduced)\n    })\n  })\n\n  if (options.timeout) {\n    timedOut(request, options.timeout)\n  }\n\n  request.once('error', callback)\n\n  // Cheating a bit here; since we're not concerned about the \"bundle size\" in node,\n  // and modifying the body stream would be sorta tricky, we're just always going\n  // to put a progress stream in the middle here. Note that\n  const {bodyStream, progress} = getProgressStream(options)\n\n  // Let middleware know we're about to do a request\n  context.applyMiddleware('onRequest', {options, adapter, request, context, progress})\n\n  if (bodyStream) {\n    bodyStream.pipe(request)\n  } else {\n    request.end(options.body)\n  }\n\n  return {abort: () => request.abort()}\n}\n\nfunction getProgressStream(options) {\n  if (!options.body) {\n    return {}\n  }\n\n  const bodyIsStream = isStream(options.body)\n  const length = options.bodySize || (bodyIsStream ? null : Buffer.byteLength(options.body))\n  if (!length) {\n    return bodyIsStream ? {bodyStream: options.body} : {}\n  }\n\n  const progress = progressStream({time: 16, length})\n  const bodyStream = bodyIsStream ? options.body : toStream(options.body)\n  return {bodyStream: bodyStream.pipe(progress), progress}\n}\n\nfunction getRequestTransport(reqOpts, proxy, tunnel) {\n  const isHttpsRequest = reqOpts.protocol === 'https:'\n  const transports =\n    reqOpts.maxRedirects === 0\n      ? {http: http, https: https}\n      : {http: follow.http, https: follow.https}\n\n  if (!proxy || tunnel) {\n    return isHttpsRequest ? transports.https : transports.http\n  }\n\n  // Assume the proxy is an HTTPS proxy if port is 443, or if there is a\n  // `protocol` option set that starts with https\n  let isHttpsProxy = proxy.port === 443\n  if (proxy.protocol) {\n    isHttpsProxy = /^https:?/.test(proxy.protocol)\n  }\n\n  return isHttpsProxy ? transports.https : transports.http\n}\n\nfunction lowerCaseHeaders(headers) {\n  return Object.keys(headers || {}).reduce((acc, header) => {\n    acc[header.toLowerCase()] = headers[header]\n    return acc\n  }, {})\n}\n"],"mappings":"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"}
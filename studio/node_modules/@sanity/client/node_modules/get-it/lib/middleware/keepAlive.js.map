{"version":3,"file":"keepAlive.js","names":["isHttpsProto","config","ms","maxFree","agentOptions","keepAlive","keepAliveMsecs","maxFreeSockets","httpAgent","http","Agent","httpsAgent","https","agents","finalizeOptions","options","agent","isHttps","test","href","protocol","keepOpts","maxRedirects"],"sources":["../../src/middleware/keepAlive.js"],"sourcesContent":["import http from 'http'\nimport https from 'https'\n\nconst isHttpsProto = /^https:/i\n\nexport default (config = {}) => {\n  const ms = config.ms || 1000\n  const maxFree = config.maxFree || 256\n  const agentOptions = {keepAlive: true, keepAliveMsecs: ms, maxFreeSockets: maxFree}\n  const httpAgent = new http.Agent(agentOptions)\n  const httpsAgent = new https.Agent(agentOptions)\n  const agents = {http: httpAgent, https: httpsAgent}\n\n  return {\n    finalizeOptions: options => {\n      if (options.agent) {\n        return options\n      }\n\n      const isHttps = isHttpsProto.test(options.href || options.protocol)\n      const keepOpts =\n        options.maxRedirects === 0 ? {agent: isHttps ? httpsAgent : httpAgent} : {agents}\n\n      return Object.assign({}, options, keepOpts)\n    }\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;;;;;AAEA,IAAMA,YAAY,GAAG,UAArB;;eAEe,oBAAiB;EAAA,IAAhBC,MAAgB,uEAAP,EAAO;EAC9B,IAAMC,EAAE,GAAGD,MAAM,CAACC,EAAP,IAAa,IAAxB;EACA,IAAMC,OAAO,GAAGF,MAAM,CAACE,OAAP,IAAkB,GAAlC;EACA,IAAMC,YAAY,GAAG;IAACC,SAAS,EAAE,IAAZ;IAAkBC,cAAc,EAAEJ,EAAlC;IAAsCK,cAAc,EAAEJ;EAAtD,CAArB;EACA,IAAMK,SAAS,GAAG,IAAIC,aAAA,CAAKC,KAAT,CAAeN,YAAf,CAAlB;EACA,IAAMO,UAAU,GAAG,IAAIC,cAAA,CAAMF,KAAV,CAAgBN,YAAhB,CAAnB;EACA,IAAMS,MAAM,GAAG;IAACJ,IAAI,EAAED,SAAP;IAAkBI,KAAK,EAAED;EAAzB,CAAf;EAEA,OAAO;IACLG,eAAe,EAAE,yBAAAC,OAAO,EAAI;MAC1B,IAAIA,OAAO,CAACC,KAAZ,EAAmB;QACjB,OAAOD,OAAP;MACD;;MAED,IAAME,OAAO,GAAGjB,YAAY,CAACkB,IAAb,CAAkBH,OAAO,CAACI,IAAR,IAAgBJ,OAAO,CAACK,QAA1C,CAAhB;MACA,IAAMC,QAAQ,GACZN,OAAO,CAACO,YAAR,KAAyB,CAAzB,GAA6B;QAACN,KAAK,EAAEC,OAAO,GAAGN,UAAH,GAAgBH;MAA/B,CAA7B,GAAyE;QAACK,MAAM,EAANA;MAAD,CAD3E;MAGA,OAAO,SAAc,EAAd,EAAkBE,OAAlB,EAA2BM,QAA3B,CAAP;IACD;EAXI,CAAP;AAaD,C"}
{"version":3,"file":"promise.js","names":["globalPromise","Promise","promise","options","implementation","Error","onReturn","channels","context","resolve","reject","cancel","cancelToken","then","reason","abort","publish","error","subscribe","response","onlyBody","body","setTimeout","request","err","Cancel","CancelToken","isCancel"],"sources":["../../src/middleware/promise.js"],"sourcesContent":["import Cancel from './cancel/Cancel'\nimport CancelToken from './cancel/CancelToken'\nimport isCancel from './cancel/isCancel'\n\nconst globalPromise = typeof Promise === 'function' && Promise\n\nconst promise = (options = {}) => {\n  const Promise = options.implementation || globalPromise\n  if (!Promise) {\n    throw new Error('`Promise` is not available in global scope, and no implementation was passed')\n  }\n\n  return {\n    onReturn: (channels, context) =>\n      new Promise((resolve, reject) => {\n        const cancel = context.options.cancelToken\n        if (cancel) {\n          cancel.promise.then(reason => {\n            channels.abort.publish(reason)\n            reject(reason)\n          })\n        }\n\n        channels.error.subscribe(reject)\n        channels.response.subscribe(response => {\n          resolve(options.onlyBody ? response.body : response)\n        })\n\n        // Wait until next tick in case cancel has been performed\n        setTimeout(() => {\n          try {\n            channels.request.publish(context)\n          } catch (err) {\n            reject(err)\n          }\n        }, 0)\n      })\n  }\n}\n\npromise.Cancel = Cancel\npromise.CancelToken = CancelToken\npromise.isCancel = isCancel\n\nexport default promise\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEA,IAAMA,aAAa,GAAG,OAAOC,OAAP,KAAmB,UAAnB,IAAiCA,OAAvD;;AAEA,IAAMC,OAAO,GAAG,SAAVA,OAAU,GAAkB;EAAA,IAAjBC,OAAiB,uEAAP,EAAO;EAChC,IAAMF,OAAO,GAAGE,OAAO,CAACC,cAAR,IAA0BJ,aAA1C;;EACA,IAAI,CAACC,OAAL,EAAc;IACZ,MAAM,IAAII,KAAJ,CAAU,8EAAV,CAAN;EACD;;EAED,OAAO;IACLC,QAAQ,EAAE,kBAACC,QAAD,EAAWC,OAAX;MAAA,OACR,IAAIP,OAAJ,CAAY,UAACQ,OAAD,EAAUC,MAAV,EAAqB;QAC/B,IAAMC,MAAM,GAAGH,OAAO,CAACL,OAAR,CAAgBS,WAA/B;;QACA,IAAID,MAAJ,EAAY;UACVA,MAAM,CAACT,OAAP,CAAeW,IAAf,CAAoB,UAAAC,MAAM,EAAI;YAC5BP,QAAQ,CAACQ,KAAT,CAAeC,OAAf,CAAuBF,MAAvB;YACAJ,MAAM,CAACI,MAAD,CAAN;UACD,CAHD;QAID;;QAEDP,QAAQ,CAACU,KAAT,CAAeC,SAAf,CAAyBR,MAAzB;QACAH,QAAQ,CAACY,QAAT,CAAkBD,SAAlB,CAA4B,UAAAC,QAAQ,EAAI;UACtCV,OAAO,CAACN,OAAO,CAACiB,QAAR,GAAmBD,QAAQ,CAACE,IAA5B,GAAmCF,QAApC,CAAP;QACD,CAFD,EAV+B,CAc/B;;QACAG,UAAU,CAAC,YAAM;UACf,IAAI;YACFf,QAAQ,CAACgB,OAAT,CAAiBP,OAAjB,CAAyBR,OAAzB;UACD,CAFD,CAEE,OAAOgB,GAAP,EAAY;YACZd,MAAM,CAACc,GAAD,CAAN;UACD;QACF,CANS,EAMP,CANO,CAAV;MAOD,CAtBD,CADQ;IAAA;EADL,CAAP;AA0BD,CAhCD;;AAkCAtB,OAAO,CAACuB,MAAR,GAAiBA,eAAjB;AACAvB,OAAO,CAACwB,WAAR,GAAsBA,oBAAtB;AACAxB,OAAO,CAACyB,QAAR,GAAmBA,iBAAnB;eAEezB,O"}